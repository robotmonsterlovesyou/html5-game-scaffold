/** vim: et:ts=4:sw=4:sts=4
 * @license RequireJS 2.2.0 Copyright jQuery Foundation and other contributors.
 * Released under MIT license, http://github.com/requirejs/requirejs/LICENSE
 */

/*!
 * Facade.js v0.3.0-beta
 * https://github.com/facadejs/facade.js
 *
 * Copyright (c) 2014 Scott Doxey
 * Released under the MIT license
 */

/*!
         * requestAnimationFrame Support
         */

/*!
     * Extend from Facade.Entity
     */

/*!
     * Extend from Facade.Polygon
     */

/*!
     * AMD Support
     */

/*!
 * plastick.js v0.4.1-beta 2015-12-10T21:32:51
 * https://github.com/syntaxtsb/plastick.js
 * 
 * Copyright (c) 2015 Travis Beebe
 * Released under the MIT license.
 */

/*!
 * gamepad.js v0.0.5-alpha 2015-11-15T01:48:54
 * https://github.com/neogeek/gamepad.js
 * 
 * Copyright (c) 2015 Scott Doxey
 * Released under the MIT license.
 */

var requirejs,require,define;!function(global){function commentReplace(t,e,i,n){return n||""}function isFunction(t){return"[object Function]"===ostring.call(t)}function isArray(t){return"[object Array]"===ostring.call(t)}function each(t,e){if(t){var i;for(i=0;i<t.length&&(!t[i]||!e(t[i],i,t));i+=1);}}function eachReverse(t,e){if(t){var i;for(i=t.length-1;i>-1&&(!t[i]||!e(t[i],i,t));i-=1);}}function hasProp(t,e){return hasOwn.call(t,e)}function getOwn(t,e){return hasProp(t,e)&&t[e]}function eachProp(t,e){var i;for(i in t)if(hasProp(t,i)&&e(t[i],i))break}function mixin(t,e,i,n){return e&&eachProp(e,function(e,r){(i||!hasProp(t,r))&&(!n||"object"!=typeof e||!e||isArray(e)||isFunction(e)||e instanceof RegExp?t[r]=e:(t[r]||(t[r]={}),mixin(t[r],e,i,n)))}),t}function bind(t,e){return function(){return e.apply(t,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(t){throw t}function getGlobal(t){if(!t)return t;var e=global;return each(t.split("."),function(t){e=e[t]}),e}function makeError(t,e,i,n){var r=new Error(e+"\nhttp://requirejs.org/docs/errors.html#"+t);return r.requireType=t,r.requireModules=n,i&&(r.originalError=i),r}function newContext(t){function e(t){var e,i;for(e=0;e<t.length;e++)if(i=t[e],"."===i)t.splice(e,1),e-=1;else if(".."===i){if(0===e||1===e&&".."===t[2]||".."===t[e-1])continue;e>0&&(t.splice(e-1,2),e-=2)}}function i(t,i,n){var r,s,o,a,h,c,p,u,d,l,f,g,m=i&&i.split("/"),y=E.map,_=y&&y["*"];if(t&&(t=t.split("/"),p=t.length-1,E.nodeIdCompat&&jsSuffixRegExp.test(t[p])&&(t[p]=t[p].replace(jsSuffixRegExp,"")),"."===t[0].charAt(0)&&m&&(g=m.slice(0,m.length-1),t=g.concat(t)),e(t),t=t.join("/")),n&&y&&(m||_)){o=t.split("/");t:for(a=o.length;a>0;a-=1){if(c=o.slice(0,a).join("/"),m)for(h=m.length;h>0;h-=1)if(s=getOwn(y,m.slice(0,h).join("/")),s&&(s=getOwn(s,c))){u=s,d=a;break t}!l&&_&&getOwn(_,c)&&(l=getOwn(_,c),f=a)}!u&&l&&(u=l,d=f),u&&(o.splice(0,d,u),t=o.join("/"))}return r=getOwn(E.pkgs,t),r?r:t}function n(t){isBrowser&&each(scripts(),function(e){return e.getAttribute("data-requiremodule")===t&&e.getAttribute("data-requirecontext")===b.contextName?(e.parentNode.removeChild(e),!0):void 0})}function r(t){var e=getOwn(E.paths,t);return e&&isArray(e)&&e.length>1?(e.shift(),b.require.undef(t),b.makeRequire(null,{skipMap:!0})([t]),!0):void 0}function s(t){var e,i=t?t.indexOf("!"):-1;return i>-1&&(e=t.substring(0,i),t=t.substring(i+1,t.length)),[e,t]}function o(t,e,n,r){var o,a,h,c,p=null,u=e?e.name:null,d=t,l=!0,f="";return t||(l=!1,t="_@r"+(P+=1)),c=s(t),p=c[0],t=c[1],p&&(p=i(p,u,r),a=getOwn(q,p)),t&&(p?f=a&&a.normalize?a.normalize(t,function(t){return i(t,u,r)}):-1===t.indexOf("!")?i(t,u,r):t:(f=i(t,u,r),c=s(f),p=c[0],f=c[1],n=!0,o=b.nameToUrl(f))),h=!p||a||n?"":"_unnormalized"+(j+=1),{prefix:p,name:f,parentMap:e,unnormalized:!!h,url:o,originalName:d,isDefine:l,id:(p?p+"!"+f:f)+h}}function a(t){var e=t.id,i=getOwn(k,e);return i||(i=k[e]=new b.Module(t)),i}function h(t,e,i){var n=t.id,r=getOwn(k,n);!hasProp(q,n)||r&&!r.defineEmitComplete?(r=a(t),r.error&&"error"===e?i(r.error):r.on(e,i)):"defined"===e&&i(q[n])}function c(t,e){var i=t.requireModules,n=!1;e?e(t):(each(i,function(e){var i=getOwn(k,e);i&&(i.error=t,i.events.error&&(n=!0,i.emit("error",t)))}),n||req.onError(t))}function p(){globalDefQueue.length&&(each(globalDefQueue,function(t){var e=t[0];"string"==typeof e&&(b.defQueueMap[e]=!0),A.push(t)}),globalDefQueue=[])}function u(t){delete k[t],delete O[t]}function d(t,e,i){var n=t.map.id;t.error?t.emit("error",t.error):(e[n]=!0,each(t.depMaps,function(n,r){var s=n.id,o=getOwn(k,s);!o||t.depMatched[r]||i[s]||(getOwn(e,s)?(t.defineDep(r,q[s]),t.check()):d(o,e,i))}),i[n]=!0)}function l(){var t,e,i=1e3*E.waitSeconds,s=i&&b.startTime+i<(new Date).getTime(),o=[],a=[],h=!1,p=!0;if(!_){if(_=!0,eachProp(O,function(t){var i=t.map,c=i.id;if(t.enabled&&(i.isDefine||a.push(t),!t.error))if(!t.inited&&s)r(c)?(e=!0,h=!0):(o.push(c),n(c));else if(!t.inited&&t.fetched&&i.isDefine&&(h=!0,!i.prefix))return p=!1}),s&&o.length)return t=makeError("timeout","Load timeout for modules: "+o,null,o),t.contextName=b.contextName,c(t);p&&each(a,function(t){d(t,{},{})}),s&&!e||!h||!isBrowser&&!isWebWorker||w||(w=setTimeout(function(){w=0,l()},50)),_=!1}}function f(t){hasProp(q,t[0])||a(o(t[0],null,!0)).init(t[1],t[2])}function g(t,e,i,n){t.detachEvent&&!isOpera?n&&t.detachEvent(n,e):t.removeEventListener(i,e,!1)}function m(t){var e=t.currentTarget||t.srcElement;return g(e,b.onScriptLoad,"load","onreadystatechange"),g(e,b.onScriptError,"error"),{node:e,id:e&&e.getAttribute("data-requiremodule")}}function y(){var t;for(p();A.length;){if(t=A.shift(),null===t[0])return c(makeError("mismatch","Mismatched anonymous define() module: "+t[t.length-1]));f(t)}b.defQueueMap={}}var _,v,b,x,w,E={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},k={},O={},S={},A=[],q={},M={},T={},P=1,j=1;return x={require:function(t){return t.require?t.require:t.require=b.makeRequire(t.map)},exports:function(t){return t.usingExports=!0,t.map.isDefine?t.exports?q[t.map.id]=t.exports:t.exports=q[t.map.id]={}:void 0},module:function(t){return t.module?t.module:t.module={id:t.map.id,uri:t.map.url,config:function(){return getOwn(E.config,t.map.id)||{}},exports:t.exports||(t.exports={})}}},v=function(t){this.events=getOwn(S,t.id)||{},this.map=t,this.shim=getOwn(E.shim,t.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},v.prototype={init:function(t,e,i,n){n=n||{},this.inited||(this.factory=e,i?this.on("error",i):this.events.error&&(i=bind(this,function(t){this.emit("error",t)})),this.depMaps=t&&t.slice(0),this.errback=i,this.inited=!0,this.ignore=n.ignore,n.enabled||this.enabled?this.enable():this.check())},defineDep:function(t,e){this.depMatched[t]||(this.depMatched[t]=!0,this.depCount-=1,this.depExports[t]=e)},fetch:function(){if(!this.fetched){this.fetched=!0,b.startTime=(new Date).getTime();var t=this.map;return this.shim?void b.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return t.prefix?this.callPlugin():this.load()})):t.prefix?this.callPlugin():this.load()}},load:function(){var t=this.map.url;M[t]||(M[t]=!0,b.load(this.map.id,t))},check:function(){if(this.enabled&&!this.enabling){var t,e,i=this.map.id,n=this.depExports,r=this.exports,s=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(isFunction(s)){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)try{r=b.execCb(i,s,n,r)}catch(o){t=o}else r=b.execCb(i,s,n,r);if(this.map.isDefine&&void 0===r&&(e=this.module,e?r=e.exports:this.usingExports&&(r=this.exports)),t)return t.requireMap=this.map,t.requireModules=this.map.isDefine?[this.map.id]:null,t.requireType=this.map.isDefine?"define":"require",c(this.error=t)}else r=s;if(this.exports=r,this.map.isDefine&&!this.ignore&&(q[i]=r,req.onResourceLoad)){var a=[];each(this.depMaps,function(t){a.push(t.normalizedMap||t)}),req.onResourceLoad(b,this.map,a)}u(i),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else hasProp(b.defQueueMap,i)||this.fetch()}},callPlugin:function(){var t=this.map,e=t.id,n=o(t.prefix);this.depMaps.push(n),h(n,"defined",bind(this,function(n){var r,s,p,d=getOwn(T,this.map.id),l=this.map.name,f=this.map.parentMap?this.map.parentMap.name:null,g=b.makeRequire(t.parentMap,{enableBuildCallback:!0});return this.map.unnormalized?(n.normalize&&(l=n.normalize(l,function(t){return i(t,f,!0)})||""),s=o(t.prefix+"!"+l,this.map.parentMap),h(s,"defined",bind(this,function(t){this.map.normalizedMap=s,this.init([],function(){return t},null,{enabled:!0,ignore:!0})})),p=getOwn(k,s.id),void(p&&(this.depMaps.push(s),this.events.error&&p.on("error",bind(this,function(t){this.emit("error",t)})),p.enable()))):d?(this.map.url=b.nameToUrl(d),void this.load()):(r=bind(this,function(t){this.init([],function(){return t},null,{enabled:!0})}),r.error=bind(this,function(t){this.inited=!0,this.error=t,t.requireModules=[e],eachProp(k,function(t){0===t.map.id.indexOf(e+"_unnormalized")&&u(t.map.id)}),c(t)}),r.fromText=bind(this,function(i,n){var s=t.name,h=o(s),p=useInteractive;n&&(i=n),p&&(useInteractive=!1),a(h),hasProp(E.config,e)&&(E.config[s]=E.config[e]);try{req.exec(i)}catch(u){return c(makeError("fromtexteval","fromText eval for "+e+" failed: "+u,u,[e]))}p&&(useInteractive=!0),this.depMaps.push(h),b.completeLoad(s),g([s],r)}),void n.load(t.name,g,r,E))})),b.enable(n,this),this.pluginMaps[n.id]=n},enable:function(){O[this.map.id]=this,this.enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(t,e){var i,n,r;if("string"==typeof t){if(t=o(t,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[e]=t,r=getOwn(x,t.id))return void(this.depExports[e]=r(this));this.depCount+=1,h(t,"defined",bind(this,function(t){this.undefed||(this.defineDep(e,t),this.check())})),this.errback?h(t,"error",bind(this,this.errback)):this.events.error&&h(t,"error",bind(this,function(t){this.emit("error",t)}))}i=t.id,n=k[i],hasProp(x,i)||!n||n.enabled||b.enable(t,this)})),eachProp(this.pluginMaps,bind(this,function(t){var e=getOwn(k,t.id);e&&!e.enabled&&b.enable(t,this)})),this.enabling=!1,this.check()},on:function(t,e){var i=this.events[t];i||(i=this.events[t]=[]),i.push(e)},emit:function(t,e){each(this.events[t],function(t){t(e)}),"error"===t&&delete this.events[t]}},b={config:E,contextName:t,registry:k,defined:q,urlFetched:M,defQueue:A,defQueueMap:{},Module:v,makeModuleMap:o,nextTick:req.nextTick,onError:c,configure:function(t){if(t.baseUrl&&"/"!==t.baseUrl.charAt(t.baseUrl.length-1)&&(t.baseUrl+="/"),"string"==typeof t.urlArgs){var e=t.urlArgs;t.urlArgs=function(t,i){return(-1===i.indexOf("?")?"?":"&")+e}}var i=E.shim,n={paths:!0,bundles:!0,config:!0,map:!0};eachProp(t,function(t,e){n[e]?(E[e]||(E[e]={}),mixin(E[e],t,!0,!0)):E[e]=t}),t.bundles&&eachProp(t.bundles,function(t,e){each(t,function(t){t!==e&&(T[t]=e)})}),t.shim&&(eachProp(t.shim,function(t,e){isArray(t)&&(t={deps:t}),!t.exports&&!t.init||t.exportsFn||(t.exportsFn=b.makeShimExports(t)),i[e]=t}),E.shim=i),t.packages&&each(t.packages,function(t){var e,i;t="string"==typeof t?{name:t}:t,i=t.name,e=t.location,e&&(E.paths[i]=t.location),E.pkgs[i]=t.name+"/"+(t.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}),eachProp(k,function(t,e){t.inited||t.map.unnormalized||(t.map=o(e,null,!0))}),(t.deps||t.callback)&&b.require(t.deps||[],t.callback)},makeShimExports:function(t){function e(){var e;return t.init&&(e=t.init.apply(global,arguments)),e||t.exports&&getGlobal(t.exports)}return e},makeRequire:function(e,r){function s(i,n,h){var p,u,d;return r.enableBuildCallback&&n&&isFunction(n)&&(n.__requireJsBuild=!0),"string"==typeof i?isFunction(n)?c(makeError("requireargs","Invalid require call"),h):e&&hasProp(x,i)?x[i](k[e.id]):req.get?req.get(b,i,e,s):(u=o(i,e,!1,!0),p=u.id,hasProp(q,p)?q[p]:c(makeError("notloaded",'Module name "'+p+'" has not been loaded yet for context: '+t+(e?"":". Use require([])")))):(y(),b.nextTick(function(){y(),d=a(o(null,e)),d.skipMap=r.skipMap,d.init(i,n,h,{enabled:!0}),l()}),s)}return r=r||{},mixin(s,{isBrowser:isBrowser,toUrl:function(t){var n,r=t.lastIndexOf("."),s=t.split("/")[0],o="."===s||".."===s;return-1!==r&&(!o||r>1)&&(n=t.substring(r,t.length),t=t.substring(0,r)),b.nameToUrl(i(t,e&&e.id,!0),n,!0)},defined:function(t){return hasProp(q,o(t,e,!1,!0).id)},specified:function(t){return t=o(t,e,!1,!0).id,hasProp(q,t)||hasProp(k,t)}}),e||(s.undef=function(t){p();var i=o(t,e,!0),r=getOwn(k,t);r.undefed=!0,n(t),delete q[t],delete M[i.url],delete S[t],eachReverse(A,function(e,i){e[0]===t&&A.splice(i,1)}),delete b.defQueueMap[t],r&&(r.events.defined&&(S[t]=r.events),u(t))}),s},enable:function(t){var e=getOwn(k,t.id);e&&a(t).enable()},completeLoad:function(t){var e,i,n,s=getOwn(E.shim,t)||{},o=s.exports;for(p();A.length;){if(i=A.shift(),null===i[0]){if(i[0]=t,e)break;e=!0}else i[0]===t&&(e=!0);f(i)}if(b.defQueueMap={},n=getOwn(k,t),!e&&!hasProp(q,t)&&n&&!n.inited){if(!(!E.enforceDefine||o&&getGlobal(o)))return r(t)?void 0:c(makeError("nodefine","No define call for "+t,null,[t]));f([t,s.deps||[],s.exportsFn])}l()},nameToUrl:function(t,e,i){var n,r,s,o,a,h,c,p=getOwn(E.pkgs,t);if(p&&(t=p),c=getOwn(T,t))return b.nameToUrl(c,e,i);if(req.jsExtRegExp.test(t))a=t+(e||"");else{for(n=E.paths,r=t.split("/"),s=r.length;s>0;s-=1)if(o=r.slice(0,s).join("/"),h=getOwn(n,o)){isArray(h)&&(h=h[0]),r.splice(0,s,h);break}a=r.join("/"),a+=e||(/^data\:|^blob\:|\?/.test(a)||i?"":".js"),a=("/"===a.charAt(0)||a.match(/^[\w\+\.\-]+:/)?"":E.baseUrl)+a}return E.urlArgs&&!/^blob\:/.test(a)?a+E.urlArgs(t,a):a},load:function(t,e){req.load(b,t,e)},execCb:function(t,e,i,n){return e.apply(n,i)},onScriptLoad:function(t){if("load"===t.type||readyRegExp.test((t.currentTarget||t.srcElement).readyState)){interactiveScript=null;var e=m(t);b.completeLoad(e.id)}},onScriptError:function(t){var e=m(t);if(!r(e.id)){var i=[];return eachProp(k,function(t,n){0!==n.indexOf("_@r")&&each(t.depMaps,function(t){return t.id===e.id?(i.push(n),!0):void 0})}),c(makeError("scripterror",'Script error for "'+e.id+(i.length?'", needed by: '+i.join(", "):'"'),t,[e.id]))}}},b.require=b.makeRequire(),b}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState?interactiveScript:(eachReverse(scripts(),function(t){return"interactive"===t.readyState?interactiveScript=t:void 0}),interactiveScript)}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.2.0",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,isBrowser=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if("undefined"==typeof define){if("undefined"!=typeof requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}"undefined"==typeof require||isFunction(require)||(cfg=require,require=void 0),req=requirejs=function(t,e,i,n){var r,s,o=defContextName;return isArray(t)||"string"==typeof t||(s=t,isArray(e)?(t=e,e=i,i=n):t=[]),s&&s.context&&(o=s.context),r=getOwn(contexts,o),r||(r=contexts[o]=req.s.newContext(o)),s&&r.configure(s),r.require(t,e,i)},req.config=function(t){return req(t)},req.nextTick="undefined"!=typeof setTimeout?function(t){setTimeout(t,4)}:function(t){t()},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(t){req[t]=function(){var e=contexts[defContextName];return e.require[t].apply(e,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(t,e,i){var n=t.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return n.type=t.scriptType||"text/javascript",n.charset="utf-8",n.async=!0,n},req.load=function(t,e,i){var n,r=t&&t.config||{};if(isBrowser)return n=req.createNode(r,e,i),n.setAttribute("data-requirecontext",t.contextName),n.setAttribute("data-requiremodule",e),!n.attachEvent||n.attachEvent.toString&&n.attachEvent.toString().indexOf("[native code")<0||isOpera?(n.addEventListener("load",t.onScriptLoad,!1),n.addEventListener("error",t.onScriptError,!1)):(useInteractive=!0,n.attachEvent("onreadystatechange",t.onScriptLoad)),n.src=i,r.onNodeCreated&&r.onNodeCreated(n,r,e,i),currentlyAddingScript=n,baseElement?head.insertBefore(n,baseElement):head.appendChild(n),currentlyAddingScript=null,n;if(isWebWorker)try{setTimeout(function(){},0),importScripts(i),t.completeLoad(e)}catch(s){t.onError(makeError("importscripts","importScripts failed for "+e+" at "+i,s,[e]))}},isBrowser&&!cfg.skipDataMain&&eachReverse(scripts(),function(t){return head||(head=t.parentNode),dataMain=t.getAttribute("data-main"),dataMain?(mainScript=dataMain,cfg.baseUrl||-1!==mainScript.indexOf("!")||(src=mainScript.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0):void 0}),define=function(t,e,i){var n,r;"string"!=typeof t&&(i=e,e=t,t=null),isArray(e)||(i=e,e=null),!e&&isFunction(i)&&(e=[],i.length&&(i.toString().replace(commentRegExp,commentReplace).replace(cjsRequireRegExp,function(t,i){e.push(i)}),e=(1===i.length?["require"]:["require","exports","module"]).concat(e))),useInteractive&&(n=currentlyAddingScript||getInteractiveScript(),n&&(t||(t=n.getAttribute("data-requiremodule")),r=contexts[n.getAttribute("data-requirecontext")])),r?(r.defQueue.push([t,e,i]),r.defQueueMap[t]=!0):globalDefQueue.push([t,e,i])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}}(this),function(t,e,i){"use strict";function n(t,i,r){if(!(this instanceof n))return new n(t,i,r);this.dt=null,this.fps=null,this.ftime=null,this._callback=null,this._requestAnimation=null,this._width=null,this._height=null,t&&"object"==typeof t&&1===t.nodeType?this.canvas=t:(this.canvas=e.createElement("canvas"),"string"==typeof t&&this.canvas.setAttribute("id",t)),i?this.width(i):this.canvas.hasAttribute("width")?this._width=parseInt(this.canvas.getAttribute("width"),10):this.width(this.canvas.clientWidth),r?this.height(r):this.canvas.hasAttribute("height")?this._height=parseInt(this.canvas.getAttribute("height"),10):this.height(this.canvas.clientHeight);try{this.context=this.canvas.getContext("2d")}catch(s){console.error("Object passed to Facade.js was not a valid canvas element.")}}var r,s,o,a=["fillStyle","font","globalAlpha","globalCompositeOperation","lineCap","lineJoin","lineWidth","miterLimit","shadowBlur","shadowColor","shadowOffsetX","shadowOffsetY","strokeStyle","textAlign","textBaseline"],h=Math.PI/180,c=new RegExp("^([-+])=");"undefined"!==String(typeof t)&&(o=e.createElement("canvas").getContext("2d"),["webkit","moz"].forEach(function(e){r=r||t.requestAnimationFrame||t[e+"RequestAnimationFrame"]||null,s=s||t.cancelAnimationFrame||t[e+"CancelAnimationFrame"]||null})),n.prototype.addToStage=function(t,e){var i,r;if(t instanceof n.Entity)t.draw(this,e);else if(Array.isArray(t))for(i=0,r=t.length;r>i;i+=1)this.addToStage(t[i],e);else console.error("Object passed to Facade.addToStage is not a valid Facade.js entity.");return this},n.prototype.clear=function(){return this.context.clearRect(0,0,this.width(),this.height()),this},n.prototype.draw=function(t){return"function"==typeof t?(this._callback=t,this.start()):console.error("Parameter passed to Facade.draw is not a valid function."),this},n.prototype.exportBase64=function(t,e){return t||(t="image/png"),"number"==typeof e?e/=100:e=1,this.canvas.toDataURL(t,e)},n.prototype.height=function(t){return t&&(this._height=parseInt(t,10),this.canvas.hasAttribute("data-resized-for-hdpi")?this.resizeForHDPI():this.canvas.setAttribute("height",this._height)),this._height},n.prototype.renderWithContext=function(t,e){var i,n,r=Object.keys(t);for(this.context.save(),i=0,n=r.length;n>i;i+=1)-1!==a.indexOf(r[i])?this.context[r[i]]=t[r[i]]:Array.isArray(t[r[i]])&&"function"==typeof this.context[r[i]]&&this.context[r[i]].apply(this.context,t[r[i]]);e&&e.call(null,this),this.context.restore()},n.prototype.resizeForHDPI=function(e){return e=e===i?t.devicePixelRatio:parseFloat(e),e>1&&(this.canvas.setAttribute("style","width: "+this.width()+"px; height: "+this.height()+"px;"),this.canvas.setAttribute("width",this.width()*e),this.canvas.setAttribute("height",this.height()*e),this.context.scale(e,e),this.canvas.setAttribute("data-resized-for-hdpi",!0)),this},n.prototype.start=function(){return this._requestAnimation=r(this._animate.bind(this)),this},n.prototype.stop=function(){return this.dt=null,this.fps=null,this.ftime=null,s(this._requestAnimation),this._requestAnimation=null,this},n.prototype.width=function(t){return t&&(this._width=parseInt(t,10),this.canvas.hasAttribute("data-resized-for-hdpi")?this.resizeForHDPI():this.canvas.setAttribute("width",this._width)),this._width},n.prototype._animate=function(t){return"function"==typeof this._callback?(this.ftime&&(this.dt=t-this.ftime,this.fps=(1e3/this.dt).toFixed(2)),this.ftime=t,this._requestAnimation=r(this._animate.bind(this)),this.context.save(),this._callback(),this.context.restore()):this.stop(),this},n.Entity=function(t){return this instanceof n.Entity?(this._options=this._defaultOptions(),this._metrics=this._defaultMetrics(),void this.setOptions(t)):new n.Entity},n.Entity.prototype._defaultOptions=function(t){var e,i,n,r;if(e={x:0,y:0,anchor:"top/left",rotate:0,scale:1},"object"==typeof t)for(i=Object.keys(t),n=0,r=i.length;r>n;n+=1)e[i[n]]=t[i[n]];return e},n.Entity.prototype._defaultMetrics=function(t){var e,i,n,r;if(e={x:null,y:null,width:null,height:null},"object"==typeof t)for(i=Object.keys(t),n=0,r=i.length;r>n;n+=1)e[i[n]]=t[i[n]];return e},n.Entity.prototype._getAnchorPoint=function(t,e){var i,r=[0,0];return t.anchor.match(/center$/)?r[0]=-e.width/2:t.anchor.match(/right$/)&&(r[0]=-e.width),t.anchor.match(/^center/)?r[1]=-e.height/2:t.anchor.match(/^bottom/)&&(r[1]=-e.height),this instanceof n.Polygon&&(i=this._getStrokeWidthOffset(t),r[0]=r[0]+i,r[1]=r[1]+i),r},n.Entity.prototype._getStrokeWidthOffset=function(t){var e=0;return t.lineWidth!==i&&(e=t.lineWidth/2),e},n.Entity.prototype._applyTransforms=function(t,e,i){var n=this._getAnchorPoint(e,{x:i.x,y:i.y,width:i.width/e.scale,height:i.height/e.scale});t.translate.apply(t,n),e.rotate&&(t.translate(-n[0],-n[1]),t.rotate(e.rotate*h),t.translate(n[0],n[1])),1!==e.scale&&(t.translate(-n[0],-n[1]),t.scale(e.scale,e.scale),t.translate(n[0],n[1]))},n.Entity.prototype.getOption=function(t){return this._options[t]!==i?this._options[t]:i},n.Entity.prototype.getAllOptions=function(){var t,e,i={},n=Object.keys(this._options);for(t=0,e=n.length;e>t;t+=1)i[n[t]]=this._options[n[t]];return i},n.Entity.prototype._setOption=function(t,e,n){var r;return this._options[t]!==i?("number"==typeof this._options[t]&&("string"==typeof e&&(r=e.match(c),r?(e=parseFloat(e.replace(c,"")),"+"===r[1]?e=this._options[t]+e:"-"===r[1]&&(e=this._options[t]-e)):e=parseFloat(e)),isNaN(e)&&(e=this._options[t],console.error("The value for "+t+" was not a valid number."))),String(typeof this._options[t])===String(typeof e)?n||(this._options[t]=e):console.error("The value for "+t+" ("+e+") was a "+String(typeof e)+" not a "+String(typeof this._options[t])+"."),e):i},n.Entity.prototype.setOptions=function(t,e){var n,r,s,o=this.getAllOptions();if(t){for(n=Object.keys(t),r=0,s=n.length;s>r;r+=1)o[n[r]]!==i&&(o[n[r]]=this._setOption(n[r],t[n[r]],e));e||this._setMetrics()}return o},n.Entity.prototype.getMetric=function(t){return this._metrics[t]!==i?this._metrics[t]:i},n.Entity.prototype.getAllMetrics=function(){var t,e,i={},n=Object.keys(this._metrics);for(t=0,e=n.length;e>t;t+=1)i[n[t]]=this._metrics[n[t]];return i},n.Entity.prototype.draw=function(t,e){var i,n=this.setOptions(e,!0);"function"==typeof this._configOptions&&(n=this._configOptions(n)),i=e?this._setMetrics(n):this.getAllMetrics(),"function"==typeof this._draw&&t.renderWithContext(n,this._draw.bind(this,t,n,i))},n.Polygon=function(t){return this instanceof n.Polygon?(this._options=this._defaultOptions(),this._metrics=this._defaultMetrics(),void this.setOptions(t)):new n.Polygon(t)},n.Polygon.prototype=Object.create(n.Entity.prototype),n.Polygon.constructor=n.Entity,n.Polygon.prototype._defaultOptions=function(t){var e,i,r,s;if(e=n.Entity.prototype._defaultOptions({opacity:100,points:[],fillStyle:"#000",strokeStyle:"",lineWidth:0,lineCap:"butt",lineJoin:"miter",closePath:!0}),t)for(i=Object.keys(t),r=0,s=i.length;s>r;r+=1)e[i[r]]=t[i[r]];return e},n.Polygon.prototype._draw=function(t,e,i){var n,r,s=t.context;if(this._applyTransforms(s,e,i),e.points.length){for(s.beginPath(),n=0,r=e.points.length;r>n;n+=1)6===e.points[n].length?s.bezierCurveTo.apply(s,e.points[n]):5===e.points[n].length?s.arc.apply(s,e.points[n]):2===e.points[n].length&&s.lineTo.apply(s,e.points[n]);e.closePath?s.closePath():s.moveTo.apply(s,e.points[r-1]),e.fillStyle&&s.fill(),e.lineWidth>0&&s.stroke()}},n.Polygon.prototype._configOptions=function(t){return t.translate=[t.x,t.y],t.globalAlpha=t.opacity/100,t},n.Polygon.prototype._setMetrics=function(t){var e,i,r,s,o=this._defaultMetrics(),a=t||this.getAllOptions(),h={top:null,right:null,bottom:null,left:null},c=this._getStrokeWidthOffset(a);for("function"==typeof this._configOptions&&(a=this._configOptions(a)),i=0,r=a.points.length;r>i;i+=1)2===a.points[i].length?e={x:a.points[i][0],y:a.points[i][1]}:5===a.points[i].length&&(o.width=2*a.points[i][2],o.height=2*a.points[i][2],e={x:a.points[i][0]-a.points[i][2],y:a.points[i][1]-a.points[i][2]}),(e.x<h.left||null===h.left)&&(h.left=e.x),(e.y<h.top||null===h.top)&&(h.top=e.y),(e.x>h.right||null===h.right)&&(h.right=e.x),(e.y>h.bottom||null===h.bottom)&&(h.bottom=e.y);return o.x=a.x+h.left,o.y=a.y+h.top,null===o.width&&null===o.height&&(o.width=h.right-h.left,o.height=h.bottom-h.top),o.width=(o.width+2*c)*a.scale,o.height=(o.height+2*c)*a.scale,s=this._getAnchorPoint(a,o),o.x=o.x+s[0]-c,o.y=o.y+s[1]-c,this instanceof n.Circle&&(o.x=o.x+a.radius,o.y=o.y+a.radius),t||(this._metrics=o),o},n.Circle=function(t){return this instanceof n.Circle?(this._options=this._defaultOptions({radius:0,begin:0,end:360,counterclockwise:!1}),this._metrics=this._defaultMetrics(),void this.setOptions(t)):new n.Circle(t)},n.Circle.prototype=Object.create(n.Polygon.prototype),n.Circle.constructor=n.Polygon,n.Circle.prototype._configOptions=function(t){return t.translate=[t.x,t.y],t.globalAlpha=t.opacity/100,t.counterclockwise?t.points=[[0,0,t.radius,t.end*h,t.begin*h]]:t.points=[[0,0,t.radius,t.begin*h,t.end*h]],t},n.Circle.prototype._getAnchorPoint=function(t,e){var i=n.Polygon.prototype._getAnchorPoint.call(this,t,e);return i[0]=i[0]+t.radius,i[1]=i[1]+t.radius,i},n.Circle.prototype._setMetrics=function(t){var e=n.Polygon.prototype._setMetrics.call(this,t),i=t||this.getAllOptions();return e.x=e.x-i.radius,e.y=e.y-i.radius,t||(this._metrics=e),e},n.Line=function(t){return this instanceof n.Line?(this._options=this._defaultOptions({x1:0,y1:0,x2:0,y2:0,lineWidth:1}),this._metrics=this._defaultMetrics(),void this.setOptions(t)):new n.Line(t)},n.Line.prototype=Object.create(n.Polygon.prototype),n.Line.constructor=n.Polygon,n.Line.prototype._configOptions=function(t){return t.translate=[t.x,t.y],t.globalAlpha=t.opacity/100,t.closePath=!1,t.points=[[t.x1,t.y1],[t.x2,t.y2]],t},n.Line.prototype._getAnchorPoint=function(t,e){var i=[0,0];return t.anchor.match(/center$/)?i[0]=-(e.width/2-t.lineWidth/2):t.anchor.match(/right$/)&&(i[0]=-(e.width-t.lineWidth)),t.anchor.match(/^center/)?i[1]=-(e.height/2-t.lineWidth/2):t.anchor.match(/^bottom/)&&(i[1]=-(e.height-t.lineWidth)),i},n.Rect=function(t){return this instanceof n.Rect?(this._options=this._defaultOptions({width:0,height:0}),this._metrics=this._defaultMetrics(),void this.setOptions(t)):new n.Rect(t)},n.Rect.prototype=Object.create(n.Polygon.prototype),n.Rect.constructor=n.Polygon,n.Rect.prototype._configOptions=function(t){return t.translate=[t.x,t.y],t.globalAlpha=t.opacity/100,t.points=[[0,0],[t.width,0],[t.width,t.height],[0,t.height]],t},n.Image=function(t,e){return this instanceof n.Image?(this._options=this._defaultOptions({width:0,height:0,tileX:1,tileY:1,offsetX:0,offsetY:0,frames:[0],speed:120,loop:!0,callback:function(){return i}}),this._metrics=this._defaultMetrics(),this.animating=!1,this.currentFrame=0,this.setOptions(e),void this.load(t)):new n.Image(t,e)},n.Image.prototype=Object.create(n.Entity.prototype),n.Image.constructor=n.Entity,n.Image.prototype.load=function(t){"object"==typeof t&&1===t.nodeType?this.image=t:(this.image=e.createElement("img"),this.image.setAttribute("src",t)),this.image.complete?this._setMetrics():this.image.addEventListener("load",this._setMetrics.bind(this,null))},n.Image.prototype.play=function(){return this.animating=!0,this},n.Image.prototype.pause=function(){return this.animating=!1,this},n.Image.prototype.reset=function(){return this.currentFrame=0,this},n.Image.prototype.stop=function(){return this.currentFrame=0,this.animating=!1,this},n.Image.prototype._configOptions=function(t){return t.translate=[t.x,t.y],this.image&&this.image.complete&&(t.width||(t.width=this.image.width),t.height||(t.height=this.image.height)),t},n.Image.prototype._setMetrics=function(t){var e,i=this._defaultMetrics(),n=t||this.getAllOptions();return"function"==typeof this._configOptions&&(n=this._configOptions(n)),i.width=n.width*n.tileX*n.scale,i.height=n.height*n.tileY*n.scale,e=this._getAnchorPoint(n,i),i.x=n.x+e[0],i.y=n.y+e[1],t||(this._metrics=i),i},n.Image.prototype._draw=function(t,e,i){var n,r,s=t.context,o=e.offsetX,a=e.offsetY,h=e.width,c=e.height,p=this.image.width,u=this.image.height;if(this.image.complete){for(this._applyTransforms(s,e,i),e.frames.length&&(o+=e.frames[this.currentFrame]*e.width,o+e.width>p&&(a+=Math.floor(o/p)*e.height,o%=p)),o+h>p&&(h=o+h-p),a+c>u&&(c=a+c-u),n=0;n<e.tileX;n+=1)for(r=0;r<e.tileY;r+=1)s.drawImage(this.image,o,a,h,c,e.width*n,e.height*r,h,c);this.animating&&(!this.ftime||t.ftime-this.ftime>=e.speed)&&(this.ftime&&(this.currentFrame+=1),this.ftime=t.ftime,this.currentFrame>=e.frames.length&&(e.loop?this.currentFrame=0:(this.currentFrame=e.frames.length-1,this.isAnimating=!1)),"function"==typeof e.callback&&e.callback.call(this,e.frames[this.currentFrame]))}},n.Text=function(t,e){return this instanceof n.Text?(this._options=this._defaultOptions({opacity:100,width:0,fontFamily:"Arial",fontStyle:"normal",fontSize:16,lineHeight:1,textAlignment:"left",textBaseline:"top",fillStyle:"#000",strokeStyle:"#000",lineWidth:0}),this._metrics=this._defaultMetrics(),this._maxLineWidth=0,this._lines=[],this.setOptions(e),void(t!==i&&this.setText(t))):new n.Text(t,e)},n.Text.prototype=Object.create(n.Entity.prototype),n.Text.constructor=n.Entity,n.Text.prototype.setText=function(t){var e,i,n=this.getAllOptions(),r=[],s=null,a="",h=0;for(this.value=t,this._maxLineWidth=n.width,this._lines=[],t&&(r=String(t).match(/\n|[\S]+ ?/g)),"function"==typeof this._configOptions&&(n=this._configOptions(n)),o.save(),o.font=n.font;r.length;)s=r.shift(),h=o.measureText(a+s.replace(/\s$/,"")).width,n.width>0&&h>n.width||s.match(/\n/)?(this._lines.push([a.replace(/\s$/,""),0,this._lines.length*(n.fontSize*n.lineHeight)]),a=s.replace(/\n/,"")):(a+=s,h>this._maxLineWidth&&(this._maxLineWidth=h));for(this._lines.push([a.replace(/\s$/,""),0,this._lines.length*(n.fontSize*n.lineHeight)]),e=0,i=this._lines.length;i>e;e+=1)h=o.measureText(this._lines[e][0]).width,"center"===n.textAlignment?this._lines[e][1]=(this._maxLineWidth-h)/2:"right"===n.textAlignment&&(this._lines[e][1]=this._maxLineWidth-h);return o.restore(),this._setMetrics(),this._lines},n.Text.prototype._draw=function(t,e,i){var n,r,s=t.context;for(this._applyTransforms(s,e,i),n=0,r=this._lines.length;r>n;n+=1)e.fillStyle&&s.fillText.apply(s,this._lines[n]),e.lineWidth&&s.strokeText.apply(s,this._lines[n])},n.Text.prototype._configOptions=function(t){return t.translate=[t.x,t.y],t.globalAlpha=t.opacity/100,
t.font=t.fontStyle+" "+parseInt(t.fontSize,10)+"px "+t.fontFamily,0===t.width&&(t.width=this._maxLineWidth),t},n.Text.prototype._setMetrics=function(t){var e,i=this._defaultMetrics(),n=t||this.getAllOptions();return"function"==typeof this._configOptions&&(n=this._configOptions(n)),this._lines&&(i.width=n.width*n.scale,i.height=this._lines.length*(n.fontSize*n.lineHeight)*n.scale),e=this._getAnchorPoint(n,i),i.x=n.x+e[0],i.y=n.y+e[1],t||(this._metrics=i),i},n.Group=function(t){return this instanceof n.Group?(this._options=this._defaultOptions(),this._metrics=this._defaultMetrics(),this._objects=[],void this.setOptions(t)):new n.Group(t)},n.Group.prototype=Object.create(n.Entity.prototype),n.Group.constructor=n.Entity,n.Group.prototype._draw=function(t,e,i){var n,r,s=t.context;for(this._applyTransforms(s,e,i),n=0,r=this._objects.length;r>n;n+=1)t.addToStage(this._objects[n])},n.Group.prototype._configOptions=function(t){return t.translate=[t.x,t.y],t},n.Group.prototype.addToGroup=function(t){var e,i;if(t instanceof n.Entity)this.hasEntity(t)||(this._objects.push(t),this._setMetrics());else if(Array.isArray(t))for(e=0,i=t.length;i>e;e+=1)this.addToGroup(t[e]);else console.error("Object passed to Facade.addToStage is not a valid Facade.js entity.")},n.Group.prototype.hasEntity=function(t){return-1!==this._objects.indexOf(t)},n.Group.prototype.removeFromGroup=function(t){t instanceof n.Entity&&this.hasEntity(t)&&(this._objects.splice(this._objects.indexOf(t),1),this._setMetrics())},n.Group.prototype._setMetrics=function(t){var e,i,n,r,s=this._defaultMetrics(),o=t||this.getAllOptions(),a={top:null,right:null,bottom:null,left:null};for(e=0,i=this._objects.length;i>e;e+=1)r=this._objects[e].getAllMetrics(),(r.x<a.left||null===a.left)&&(a.left=r.x),(r.y<a.top||null===a.top)&&(a.top=r.y),(r.x+r.width>a.right||null===a.right)&&(a.right=r.x+r.width),(r.y+r.height>a.bottom||null===a.bottom)&&(a.bottom=r.y+r.height);return s.x=o.x+a.left,s.y=o.y+a.top,s.width=(a.right-a.left)*o.scale,s.height=(a.bottom-a.top)*o.scale,n=this._getAnchorPoint(o,s),s.x=o.x+n[0],s.y=o.y+n[1],t||(this._metrics=s),s},"function"==typeof define&&define.amd!==i?define("facade",[],function(){return n}):"object"==typeof module&&module.exports!==i?module.exports=n:t.Facade=n}(window,document),!function(){"use strict";function t(t,e){this.TARGET_TPS=30,this.TICK_CHOKE=50,this.stage=t,this.context=void 0!==this.stage.getContext?t.getContext("2d"):this.stage.context,this.HDPIDisplay=e,this.data={},this.methods={},this.states=[],this.startTime=null,this.currentTick=0,this.tickTime=0,this.tickAlpha=0,this.freezeOnBlur=!0,this._isRunning=!1,this._freezeStart=null,this._frameTime=0,this._freezeLength=0,this._debugMode=!1,this._debugStopGameEvent=function(t){32===t.keyCode&&t.shiftKey&&(t.preventDefault(),this.stop())}.bind(this),document.addEventListener(i,this._freeze.bind(this)),void 0!==this.stage.getContext&&this.HDPIDisplay&&(this.HDPIDisplay="number"==typeof this.HDPIDisplay?this.HDPIDisplay:2,this.stage.setAttribute("style","width: "+this.stage.width+"px; height: "+this.stage.height+"px;"),this.stage.setAttribute("width",this.stage.width*this.HDPIDisplay),this.stage.setAttribute("height",this.stage.height*this.HDPIDisplay),this.context.scale(this.HDPIDisplay,this.HDPIDisplay),this.stage.setAttribute("data-resized-for-hdpi",!0))}!function(){if(window.performance=window.performance||{},!window.performance.now){var t=Date.now();window.performance.now=function(){return Date.now()-t}}}();var e,i;"undefined"!==document.hidden?(e="hidden",i="visibilitychange"):"undefined"!==document.mozHidden?(e="mozHidden",i="mozvisibilitychange"):"undefined"!==document.msHidden?(e="msHidden",i="msvisibilitychange"):"undefined"!==document.webkitHidden&&(e="webkitHidden",i="webkitvisibilitychange"),t.prototype.start=function(e){var i=this.isRunning(),n=void 0!==this.stage.getContext?"native canvas":"Facade";return e instanceof t.State&&!i?(this._isRunning=!0,this.startTime=window.performance.now(),this.tickTime=0,this._frameTime=0,this.states.push(e),this._debugMode&&this.debug("Game started, using "+n+" ("+this.currentState().name+")"),this._createEventListeners(e),e._init(this),void 0!==this.stage.getContext?window.requestAnimationFrame(this._requestAnimationFrame.bind(this)):this.stage.draw(this._gameLoop.bind(this)),!0):e instanceof t.State&&!this.wasRunning},t.prototype.stop=function(){var t=this.isRunning();return t&&(this._isRunning=!1,void 0===this.stage.getContext&&this.stage.stop(),this._cleanup(),this._debugMode&&this.debug("Game stopped")),t},t.prototype.isRunning=function(){return this._isRunning},t.prototype.pushState=function(e){var i=this.currentState();return i&&e instanceof t.State&&(i._pause(this),this._destroyEventListeners(i),this.states.push(e),this._debugMode&&this.debug("Pushed state ("+i.name+" -> "+this.currentState().name+")"),this._createEventListeners(e),e._init(this)),e instanceof t.State},t.prototype.popState=function(){var t,e=this.states.pop();return e&&(e._cleanup(this),this._destroyEventListeners(e)),t=this.currentState(),t?(this._debugMode&&this.debug("Popped state ("+e.name+" -> "+this.currentState().name+")"),this._createEventListeners(t),t._resume(this)):(this._debugMode&&this.debug("Popped state ("+e.name+" -> [empty])"),this.stop()),void 0!==e},t.prototype.changeState=function(e){var i=this.currentState();return i&&e instanceof t.State&&(this.states.pop(),i._cleanup(this),this._destroyEventListeners(i),this.states.push(e),this._debugMode&&this.debug("Changed state ("+i.name+" -> "+this.currentState().name+")"),this._createEventListeners(e),e._init(this)),void 0!==i&&e instanceof t.State},t.prototype.currentState=function(){return this.states[this.states.length-1]},t.prototype.gameTime=function(t){return t?t-this.startTime-this._freezeLength:window.performance.now()-this.startTime-this._freezeLength},t.prototype.lerp=function(t,e,i){return void 0===i&&(i=this.tickAlpha),(e-t)*i+t},t.prototype.width=function(){return this.HDPIDisplay?this.stage.width/this.HDPIDisplay:this.stage.width},t.prototype.height=function(){return this.HDPIDisplay?this.stage.height/this.HDPIDisplay:this.stage.height},t.prototype.setDebug=function(t){t===!0&&this._debugMode===!1?(this._debugMode=!0,document.addEventListener("keydown",this._debugStopGameEvent)):t===!1&&this._debugMode===!0&&(this._debugMode=!1,document.removeEventListener("keydown",this._debugStopGameEvent))},t.prototype.debug=function(t){this._debugMode&&console.info("Plastick ("+this.currentTick+" @ "+(+this.gameTime()/1e3).toFixed(3)+"s): "+t)},t.prototype._cleanup=function(){for(;this.states.length;)this.popState();return!0},t.prototype._freeze=function(){this.freezeOnBlur&&document[e]&&this.isRunning()&&(this._freezeStart=window.performance.now(),this._destroyEventListeners(this.currentState())),this.freezeOnBlur&&!document[e]&&this.isRunning()&&(this._freezeLength+=window.performance.now()-this._freezeStart,this._freezeStart=null,this._createEventListeners(this.currentState()))},t.prototype._createEventListeners=function(t){t.listeners.forEach(function(t){t.element.addEventListener(t.eventType,t.callback)})},t.prototype._destroyEventListeners=function(t){t.listeners.forEach(function(t){t.element.removeEventListener(t.eventType,t.callback)})},t.prototype._gameLoop=function(){var t=0,e=this.currentState();for(this._frameTime=this.gameTime();this._frameTime*this.TARGET_TPS/1e3>this.currentTick&&t<this.TICK_CHOKE&&this._isRunning;)this.currentTick+=1,t+=1,this.currentState()._update(this),this.tickTime=this.gameTime();this._isRunning&&this.currentState()===e&&(this.tickAlpha=this.gameTime()*this.TARGET_TPS/1e3-this.currentTick+1,this.currentState()._draw(this))},t.prototype._requestAnimationFrame=function(){return this._gameLoop(),this._isRunning?window.requestAnimationFrame(this._requestAnimationFrame.bind(this)):void 0},t.State=function(t){this._init=function(){},this._cleanup=function(){},this._update=function(){},this._draw=function(){},this._pause=function(){},this._resume=function(){},this.name=t,this.data={},this.methods={},this.listeners=[]},t.State.prototype.registerListener=function(t,e,i){this.listeners.push({element:t,eventType:e,callback:i})},t.State.prototype.deregisterListener=function(t,e,i){var n;n=this.listeners.slice(),n.forEach(function(n,r){n.element!==t||n.eventType!==e||n.callback!==i&&void 0!==i||this.listeners.splice(r,1)})},t.State.prototype.init=function(t){return"function"==typeof t&&(this._init=t),this._init},t.State.prototype.cleanup=function(t){return"function"==typeof t&&(this._cleanup=t),this._cleanup},t.State.prototype.update=function(t){return"function"==typeof t&&(this._update=t),this._update},t.State.prototype.draw=function(t){return"function"==typeof t&&(this._draw=t),this._draw},t.State.prototype.pause=function(t){return"function"==typeof t&&(this._pause=t),this._pause},t.State.prototype.resume=function(t){return"function"==typeof t&&(this._resume=t),this._resume},"function"==typeof define&&void 0!==define.amd?define("plastick",[],function(){return t}):"object"==typeof module&&void 0!==module.exports?module.exports=t:window.Plastick=t}(),define("game/game",["require","facade","plastick"],function(t){var e=t("facade"),i=t("plastick"),n=new e(document.querySelector("canvas")),r=new i(n);return r.TARGET_TPS=60,r.setDebug(!0),n.resizeForHDPI(),r}),!function(){"use strict";function t(t,e){var i=[];return Object.keys(e).forEach(function(n){e[n]===t?i.push(n):Array.isArray(e[n])&&-1!==e[n].indexOf(t)&&i.push(n)}),i}function e(){this._events={gamepad:[],axes:[],keyboard:{}},this._handlers={gamepad:{connect:null,disconnect:null}},this._keyMapping={gamepad:{button_1:0,button_2:1,button_3:2,button_4:3,shoulder_top_left:4,shoulder_top_right:5,shoulder_bottom_left:6,shoulder_bottom_right:7,select:8,start:9,stick_button_left:10,stick_button_right:11,d_pad_up:12,d_pad_down:13,d_pad_left:14,d_pad_right:15,vendor:16},axes:{stick_axis_left:[0,2],stick_axis_right:[2,4]},keyboard:{button_1:32,start:27,d_pad_up:[38,87],d_pad_down:[40,83],d_pad_left:[37,65],d_pad_right:[39,68]}},this._threshold=.3,this._listeners=[],this._handleKeyboardEventListener=this._handleKeyboardEventListener.bind(this),this.resume()}var i,n,r=void 0!==window.navigator.getGamepads;"undefined"!==String(typeof window)&&["webkit","moz"].forEach(function(t){i=i||window.requestAnimationFrame||window[t+"RequestAnimationFrame"]||null,n=n||window.cancelAnimationFrame||window[t+"CancelAnimationFrame"]||null}),e.prototype._handleGamepadConnected=function(t){this._handlers.gamepad.connect&&this._handlers.gamepad.connect({index:t})},e.prototype._handleGamepadDisconnected=function(t){this._handlers.gamepad.disconnect&&this._handlers.gamepad.disconnect({index:t})},e.prototype._handleGamepadEventListener=function(e){var i=this;e&&e.connected&&e.buttons.forEach(function(n,r){var s=t(r,i._keyMapping.gamepad);s&&s.forEach(function(t){n.pressed?(i._events.gamepad[e.index][t]||(i._events.gamepad[e.index][t]={pressed:!0,hold:!1,released:!1,player:e.index}),i._events.gamepad[e.index][t].value=n.value):!n.pressed&&i._events.gamepad[e.index][t]&&(i._events.gamepad[e.index][t].released=!0,i._events.gamepad[e.index][t].hold=!1)})})},e.prototype._handleGamepadAxisEventListener=function(t){var e=this;t&&t.connected&&Object.keys(e._keyMapping.axes).forEach(function(i){var n=Array.prototype.slice.apply(t.axes,e._keyMapping.axes[i]);Math.abs(n[0])>e._threshold||Math.abs(n[1])>e._threshold?e._events.axes[t.index][i]={pressed:e._events.axes[t.index][i]?!1:!0,hold:e._events.axes[t.index][i]?!0:!1,released:!1,value:n}:e._events.axes[t.index][i]&&(e._events.axes[t.index][i]={pressed:!1,hold:!1,released:!0,value:n})})},e.prototype._handleKeyboardEventListener=function(e){var i=this,n=t(e.keyCode,i._keyMapping.keyboard);n&&n.forEach(function(t){"keydown"!==e.type||i._events.keyboard[t]?"keyup"===e.type&&i._events.keyboard[t]&&(i._events.keyboard[t].released=!0,i._events.keyboard[t].hold=!1):i._events.keyboard[t]={pressed:!0,hold:!1,released:!1}})},e.prototype._handleEvent=function(t,e,i){e[t].pressed?(this.trigger("press",t,e[t].value,i),e[t].pressed=!1,e[t].hold=!0):e[t].hold?this.trigger("hold",t,e[t].value,i):e[t].released&&(this.trigger("release",t,e[t].value,i),delete e[t])},e.prototype._loop=function(){var t,e=this,n=r?window.navigator.getGamepads():!1,s=4;if(n){for(t=0;s>t;t+=1)n[t]?(e._events.gamepad[t]||(e._handleGamepadConnected(t),e._events.gamepad[t]={},e._events.axes[t]={}),e._handleGamepadEventListener(n[t]),e._handleGamepadAxisEventListener(n[t])):e._events.gamepad[t]&&(e._handleGamepadDisconnected(t),e._events.gamepad[t]=null,e._events.axes[t]=null);e._events.gamepad.forEach(function(t,i){t&&Object.keys(t).forEach(function(n){e._handleEvent(n,t,i)})}),e._events.axes.forEach(function(t,i){t&&Object.keys(t).forEach(function(n){e._handleEvent(n,t,i)})})}Object.keys(e._events.keyboard).forEach(function(t){e._handleEvent(t,e._events.keyboard,"keyboard")}),e._requestAnimation&&(e._requestAnimation=i(e._loop.bind(e)))},e.prototype.on=function(t,e,i,n){var r=this;-1!==Object.keys(this._handlers.gamepad).indexOf(t)&&"function"==typeof e?(this._handlers.gamepad[t]=e,this._events.gamepad=[]):("string"==typeof t&&t.match(/\s+/)&&(t=t.split(/\s+/g)),"string"==typeof e&&e.match(/\s+/)&&(e=e.split(/\s+/g)),Array.isArray(t)?t.forEach(function(t){r.on(t,e,i,n)}):Array.isArray(e)?e.forEach(function(e){r.on(t,e,i,n)}):this._listeners.push({type:t,button:e,callback:i,options:n}))},e.prototype.setCustomMapping=function(t,e){if(void 0===this._keyMapping[t])throw new Error('The device "'+t+'" is not supported through gamepad.js');this._keyMapping[t]=e},e.prototype.setGlobalThreshold=function(t){this._threshold=parseFloat(t)},e.prototype.trigger=function(t,e,i,n){this._listeners&&this._listeners.forEach(function(r){r.type===t&&r.button===e&&r.callback({type:r.type,button:r.button,value:i,player:n,event:r,timestamp:Date.now()})})},e.prototype.pause=function(){n(this._requestAnimation),this._requestAnimation=null,document.removeEventListener("keydown",this._handleKeyboardEventListener),document.removeEventListener("keyup",this._handleKeyboardEventListener)},e.prototype.resume=function(){this._requestAnimation=i(this._loop.bind(this)),document.addEventListener("keydown",this._handleKeyboardEventListener),document.addEventListener("keyup",this._handleKeyboardEventListener)},e.prototype.destroy=function(){this.pause(),delete this._listeners},"function"==typeof define&&void 0!==define.amd?define("gamepad",[],function(){return e}):"object"==typeof module&&void 0!==module.exports?module.exports=e:window.Gamepad=e}(),define("game/controller",["require","gamepad"],function(t){var e=t("gamepad");return function(t){var i=new e,n=Object.keys(i._keyMapping.gamepad);return i.setGlobalThreshold(.1),n=n.concat(Object.keys(i._keyMapping.axes)),n.splice(n.indexOf("shoulder_bottom_left"),1),n.splice(n.indexOf("shoulder_bottom_right"),1),i.queue=[],i.on("hold",n,function(t){i.queue.push(t)}),i.on("press",n,function(t){i.queue.push(t)}),i.on("release",n,function(t){i.queue.push(t)}),i.pause(),t.init(function(){i.resume()}),t.pause(function(){i.pause()}),t.resume(function(){i.resume()}),t.cleanup(function(){i.destroy()}),i}}),define("game/level",["require","facade","plastick","./game","./controller"],function(t){var e=t("facade"),i=t("plastick"),n=t("./game"),r=new i.State("level"),s=t("./controller")(r),o=new e.Rect({x:n.stage.width()/2,y:n.stage.height()/2,width:25,height:25,anchor:"center"}),a=5;return r.update(function(){var t;if(s.queue.length)for(;s.queue.length;)t=s.queue.shift(),"hold"===t.type&&"d_pad_left"===t.button?o.setOptions({x:"-="+a}):"hold"===t.type&&"d_pad_right"===t.button?o.setOptions({x:"+="+a}):"hold"===t.type&&"d_pad_up"===t.button?o.setOptions({y:"-="+a}):"hold"===t.type&&"d_pad_down"===t.button?o.setOptions({y:"+="+a}):"hold"===t.type&&"stick_axis_left"===t.button&&(t.value[0]<-.1?o.setOptions({x:"-="+a}):t.value[0]>.1&&o.setOptions({x:"+="+a}),t.value[1]<-.1?o.setOptions({y:"-="+a}):t.value[1]>.1&&o.setOptions({y:"+="+a}))}),r.draw(function(){n.stage.clear(),n.stage.addToStage(o)}),r}),define("game/intro",["require","facade","plastick","./game","./level","./controller"],function(t){var e=t("facade"),i=t("plastick"),n=t("./game"),r=t("./level"),s=new i.State("intro"),o=t("./controller")(s),a=new e.Text("Hello World!",{y:n.stage.height()/2-20,width:n.stage.width(),fontSize:20,textAlignment:"center"});return s.update(function(){var t;if(o.queue.length)for(;o.queue.length;)t=o.queue.shift(),"press"===t.type&&"button_1"===t.button&&n.changeState(r)}),s.draw(function(){n.stage.clear(),n.stage.addToStage(a)}),s}),define("app",["require","./game/game","./game/intro"],function(t){var e=t("./game/game"),i=t("./game/intro");e.start(i)}),require.config({urlArgs:"bust="+(new Date).getTime(),paths:{box2dweb:"../bower_components/facadejs-Box2D-plugin/vendor/box2dweb/Box2dWeb-2.1.a.3",facade:"../bower_components/facade.js/facade","facadejs-Box2D-plugin":"../bower_components/facadejs-Box2D-plugin/facadejs-Box2D",gamepad:"../bower_components/gamepad.js/gamepad.min",plastick:"../bower_components/plastick.js/plastick.min"},shim:{box2dweb:{exports:"Box2D"}}}),require(["app"]),define("config",function(){});